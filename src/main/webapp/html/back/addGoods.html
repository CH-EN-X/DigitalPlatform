<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>添加商品信息</title>
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <link rel="stylesheet" href="../../layui/css/layui.css" tppabs="//res.ilayuis.com/layui/dist/css/layui.css"
        media="all">
  <!-- 注意：如果你直接复制所有代码到本地，上述css路径需要改成你本地的 -->
</head>
<body>

<!-- <blockquote class="layui-elem-quote layui-text">
  鉴于小伙伴的普遍反馈，先温馨提醒两个常见“问题”：1. <a href="../doc/base/faq.html#form" tppabs="http://www.ilayuis.com/doc/base/faq.html#form" target="_blank">为什么select/checkbox/radio没显示？</a> 2. <a href="../doc/modules/form.html#render" tppabs="http://www.ilayuis.com/doc/modules/form.html#render" target="_blank">动态添加的表单元素如何更新？</a>
</blockquote> -->

<fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
  <legend>添加商品信息</legend>
</fieldset>

<form class="layui-form" action="" id="form_film" method="post" enctype="multipart/form-data">

  <div class="layui-form-item">
    <label class="layui-form-label">商品类型</label>
    <div class="layui-input-block">
      <select name="interest" lay-filter="interestSelect" lay-verify="required">
        <option value=""></option>
        <option :value="t.tId" v-for="t in types" :key="t.tName">{{t.tName}}</option>
      </select>
    </div>
  </div>


  <div class="layui-form-item">
    <label class="layui-form-label">商品名称</label>
    <div class="layui-input-block">
      <input type="text" name="pName" id="pName" lay-verify="required|title" autocomplete="off"
             placeholder="请输入商品名称"
             class="layui-input">
    </div>
  </div>


  <div class="layui-form-item">
    <div class="layui-inline">
      <label class="layui-form-label">库存</label>
      <div class="layui-input-inline">
        <input type="number" name="stock" id="stock" lay-verify="required|stock" autocomplete="off"
               class="layui-input">
      </div>
      <label class="layui-form-label" style="padding-left: 0;text-align: left;">台</label>
    </div>
  </div>

  <div class="layui-form-item">
    <label class="layui-form-label">商品图片</label>
    <div class="layui-upload">
      <!--<button type="button" class="layui-btn" id="test2">多图片上传</button>
      <blockquote class="layui-elem-quote layui-quote-nm" style="margin-top: 10px;margin-left: 110px;">
          预览图：
          <div class="layui-upload-list" id="demo2"></div>
      </blockquote>-->
      <input type="file" id="pImage" name="pImage" multiple="multiple"
             onchange="setImagePreviews(this,'showpic')">
    </div>

  </div>


  <div class="layui-form-item">
    <div class="layui-input-block">
      <button type="submit" id="test9" class="layui-btn" lay-submit lay-filter="submitForm">立即添加</button>
      <button type="reset" class="layui-btn layui-btn-primary">重置</button>
    </div>
  </div>
</form>


<script src="../../js/showpic.js"></script>
<script type="text/javascript" src="../../js/jquery-3.4.1.min.js"></script>
<script src="../../layui/layui.js" charset="utf-8"></script>
<script src="../../js/ajaxfileupload.js"></script>
<script src="../../js/vue.js"></script>
<script src="../../js/axios.js"></script>
<!-- 注意：如果你直接复制所有代码到本地，上述 JS 路径需要改成你本地的 -->
<script>

  var v = new Vue({
    el: '#form_film',
    data: {
      types: [],
      tId: 0
    },
    methods: {},
    mounted: function () {
      axios.get('../../type?op=findType').then(rs => {
        if (rs.status == 200) {
          this.types = rs.data.data;
        }
      });
    },
    updated() {
      this.$nextTick(function () {
        layui.form.render('select'); // Update LayUI form
      })
    }

  });

  //获取tId
  layui.use('form', function () {
    var form = layui.form;

    // 监听select选择事件
    form.on('select(interestSelect)', function (data) {
      v.tId = data.value;
    });
  });

  layui.use(['upload', 'element', 'layer', 'form'], function () {
    let upload = layui.upload
            , element = layui.element
            , layer = layui.layer
            , form = layui.form;

    $("#test9").click(function () {
      let pName = $("#form_film input[name='pName']").val();
      let stock = $("#form_film input[name='stock']").val();



      $.ajaxFileUpload({
        url: '../../prodDetails',
        dataType: 'json',
        fileElementId:  'pImage',
        secureuri: false,
        data: {
          tId: v.tId,
          pName: pName,
          stock: stock,
        },
        success: function (rs) {
          layer.alert(rs.msg);
        },
        error: function (rs) {
          alert('添加失败');
        }
      });
    });
  });


</script>
</body>
</html>
